<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>健康饮食 - 美食社区</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#22c55e',
            secondary: '#f97316',
            neutral: '#f8fafc',
            dark: '#1e293b',
          },
        },
      }
    }
  </script>
  <style>
    /* 自定义滚动条 */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }

    /* 帖子图片预览 */
    .image-preview img {
      transition: transform 0.3s ease;
      object-fit: cover;
    }

    .image-preview img:hover {
      transform: scale(1.05);
    }

    /* 上传图片容器样式 */
    .upload-container {
      position: relative;
    }

    .preview-item {
      position: relative;
      margin-right: 8px;
      margin-bottom: 8px;
    }

    .remove-img {
      position: absolute;
      top: -5px;
      right: -5px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 12px;
      color: #ef4444;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    /* 帖子删除按钮样式 */
    .delete-post-btn {
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .post-card:hover .delete-post-btn {
      opacity: 1;
    }
  </style>
</head>

<body class="bg-neutral min-h-screen flex flex-col">
  <!-- 导航栏 -->
  <nav class="bg-white shadow-md sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3">
      <div class="flex justify-between items-center">
        <a href="index.html" class="text-2xl font-bold text-primary">健康饮食</a>

        <!-- 桌面导航 -->
        <div class="hidden md:flex space-x-6">
          <a href="index.html" class="text-dark hover:text-primary font-medium">首页</a>
          <a href="diet-advice.html" class="text-dark hover:text-primary font-medium">饮食建议</a>
          <a href="recipe-library.html" class="text-dark hover:text-primary font-medium">食谱库</a>
          <a href="calorie-calculator.html" class="text-dark hover:text-primary font-medium">卡路里计算</a>
          <a href="diet-record.html" class="text-dark hover:text-primary font-medium">饮食记录</a>
          <a href="community.html" class="text-primary font-medium border-b-2 border-primary">美食社区</a>
        </div>

        <!-- 用户操作 -->
        <div class="flex items-center space-x-4">
          <a href="login.html" class="hidden md:block text-dark hover:text-primary font-medium">登录</a>
          <a href="register.html"
            class="hidden md:block bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition">注册</a>

          <!-- 移动端菜单按钮 -->
          <button id="menuBtn" class="md:hidden text-dark text-xl">
            <i class="fa fa-bars"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- 移动端导航菜单 -->
    <div id="mobileMenu" class="md:hidden hidden bg-white shadow-lg absolute w-full">
      <div class="container mx-auto px-4 py-3 flex flex-col space-y-4">
        <a href="index.html" class="text-dark hover:text-primary font-medium py-2 border-b">首页</a>
        <a href="diet-advice.html" class="text-dark hover:text-primary font-medium py-2 border-b">饮食建议</a>
        <a href="recipe-library.html" class="text-dark hover:text-primary font-medium py-2 border-b">食谱库</a>
        <a href="calorie-calculator.html" class="text-dark hover:text-primary font-medium py-2 border-b">卡路里计算</a>
        <a href="diet-record.html" class="text-dark hover:text-primary font-medium py-2 border-b">饮食记录</a>
        <a href="community.html" class="text-primary font-medium py-2 border-b">美食社区</a>
        <div class="flex space-x-4 pt-2">
          <a href="login.html" class="text-dark hover:text-primary font-medium">登录</a>
          <a href="register.html"
            class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition">注册</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- 社区内容 -->
  <section class="py-12 flex-grow">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold text-center mb-12 text-dark">美食社区</h2>

      <!-- 社区头部 -->
      <div class="bg-white rounded-xl shadow-lg p-6 mb-10 max-w-5xl mx-auto">
        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
          <div class="flex items-center">
            <img src="https://picsum.photos/64/64?user=1" alt="我的头像" class="w-12 h-12 rounded-full object-cover mr-4">
            <div>
              <h3 class="font-medium text-dark">欢迎来到美食社区</h3>
              <p class="text-sm text-gray-500">分享你的健康饮食经验，结识志同道合的朋友</p>
            </div>
          </div>

          <button id="publishBtn"
            class="bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary/90 transition font-medium flex items-center">
            <i class="fa fa-pencil mr-2"></i> 发布新帖子
          </button>
        </div>
      </div>

      <!-- 标签筛选 -->
      <div class="flex flex-wrap gap-2 mb-10 max-w-5xl mx-auto">
        <button class="community-tag active bg-primary text-white px-4 py-2 rounded-full text-sm">全部</button>
        <button
          class="community-tag bg-gray-100 text-dark px-4 py-2 rounded-full text-sm hover:bg-gray-200">#减脂餐</button>
        <button
          class="community-tag bg-gray-100 text-dark px-4 py-2 rounded-full text-sm hover:bg-gray-200">#健身餐</button>
        <button
          class="community-tag bg-gray-100 text-dark px-4 py-2 rounded-full text-sm hover:bg-gray-200">#素食</button>
        <button
          class="community-tag bg-gray-100 text-dark px-4 py-2 rounded-full text-sm hover:bg-gray-200">#早餐</button>
        <button
          class="community-tag bg-gray-100 text-dark px-4 py-2 rounded-full text-sm hover:bg-gray-200">#家常菜</button>
        <button
          class="community-tag bg-gray-100 text-dark px-4 py-2 rounded-full text-sm hover:bg-gray-200">#低卡</button>
        <button
          class="community-tag bg-gray-100 text-dark px-4 py-2 rounded-full text-sm hover:bg-gray-200">#增肌</button>
      </div>

      <!-- 社区帖子列表 -->
      <div id="communityPosts" class="max-w-5xl mx-auto">
        <!-- 帖子会通过JS动态渲染 -->
      </div>

      <!-- 加载更多 -->
      <div class="text-center mt-12">
        <button id="loadMorePosts"
          class="bg-white border border-primary text-primary px-8 py-3 rounded-lg hover:bg-primary/5 transition font-medium">
          加载更多 <i class="fa fa-refresh ml-2"></i>
        </button>
      </div>
    </div>

    <!-- 发布帖子模态框 -->
    <div id="publishModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <div class="p-6 border-b border-gray-200">
          <div class="flex justify-between items-center">
            <h3 class="text-xl font-bold text-dark">发布新帖子</h3>
            <button id="closePublishModal"
              class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500 hover:bg-gray-200 transition">
              <i class="fa fa-times"></i>
            </button>
          </div>
        </div>

        <form id="publishPostForm" class="p-6">
          <!-- 发帖内容 -->
          <div class="mb-6">
            <label class="block text-gray-700 mb-2">分享你的健康饮食经验</label>
            <textarea id="postContent" rows="6"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
              placeholder="分享你的饮食心得、食谱、减脂经验...可以使用#话题标签哦"></textarea>
          </div>

          <!-- 图片上传 -->
          <div class="mb-6">
            <label class="block text-gray-700 mb-2">添加图片 (可选，最多9张)</label>
            <div class="flex items-center flex-wrap">
              <label for="postImages" class="cursor-pointer upload-container">
                <div
                  class="w-16 h-16 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center text-gray-400 hover:border-primary hover:text-primary transition">
                  <i class="fa fa-plus text-xl"></i>
                </div>
              </label>
              <input type="file" id="postImages" class="hidden" accept="image/*" multiple>

              <!-- 图片预览 -->
              <div id="imagePreview" class="flex flex-wrap ml-4 image-preview"></div>
            </div>
          </div>

          <!-- 发布按钮 -->
          <div class="flex space-x-4">
            <button type="button" id="cancelPublish"
              class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg hover:bg-gray-200 transition font-medium">
              取消
            </button>
            <button type="submit"
              class="flex-1 bg-primary text-white py-3 rounded-lg hover:bg-primary/90 transition font-medium">
              发布帖子
            </button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- 页脚 -->
  <footer class="bg-dark text-white mt-auto">
    <div class="container mx-auto px-4 py-12">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <h3 class="text-xl font-bold mb-4 text-primary">健康饮食</h3>
          <p class="text-gray-400 mb-4">关注饮食健康，享受美好生活</p>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-400 hover:text-white transition"><i class="fa fa-weixin text-xl"></i></a>
            <a href="#" class="text-gray-400 hover:text-white transition"><i class="fa fa-weibo text-xl"></i></a>
            <a href="#" class="text-gray-400 hover:text-white transition"><i class="fa fa-qq text-xl"></i></a>
          </div>
        </div>

        <div>
          <h3 class="text-xl font-bold mb-4">快速链接</h3>
          <ul class="space-y-2">
            <li><a href="index.html" class="text-gray-400 hover:text-white transition">首页</a></li>
            <li><a href="diet-advice.html" class="text-gray-400 hover:text-white transition">饮食建议</a></li>
            <li><a href="recipe-library.html" class="text-gray-400 hover:text-white transition">食谱库</a></li>
            <li><a href="community.html" class="text-gray-400 hover:text-white transition">美食社区</a></li>
          </ul>
        </div>

        <div>
          <h3 class="text-xl font-bold mb-4">功能服务</h3>
          <ul class="space-y-2">
            <li><a href="calorie-calculator.html" class="text-gray-400 hover:text-white transition">卡路里计算</a></li>
            <li><a href="diet-record.html" class="text-gray-400 hover:text-white transition">饮食记录</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white transition">营养报告</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white transition">个性化推荐</a></li>
          </ul>
        </div>

        <div>
          <h3 class="text-xl font-bold mb-4">联系我们</h3>
          <ul class="space-y-2">
            <li class="text-gray-400"><i class="fa fa-phone mr-2"></i> 400-123-4567</li>
            <li class="text-gray-400"><i class="fa fa-envelope mr-2"></i> contact@healthdiet.com</li>
            <li class="text-gray-400"><i class="fa fa-map-marker mr-2"></i> 北京市朝阳区健康大厦</li>
          </ul>
        </div>
      </div>

      <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
        <p>© 2025 健康饮食 版权所有 | 京ICP备12345678号</p>
      </div>
    </div>
  </footer>

  <script>
    // ========== 全局变量 & 初始化 ==========
    // 帖子数据（持久化存储）
    let communityPosts = JSON.parse(localStorage.getItem('communityPosts')) || [
      // 示例帖子
      {
        id: 1733500000001,
        author: '减脂达人',
        avatar: 'https://picsum.photos/64/64?user=2',
        content: '分享我的一周减脂餐食谱，每天不重样，好吃又低卡！#减脂餐 #低卡',
        images: ['https://picsum.photos/300/200?food=1'],
        likes: 128,
        comments: 36,
        shares: 15,
        postTime: '2小时前',
        isLiked: false
      },
      {
        id: 1733500000002,
        author: '健身厨神',
        avatar: 'https://picsum.photos/64/64?user=3',
        content: '增肌期必吃的高蛋白早餐，5分钟搞定！#健身餐 #增肌 #早餐',
        images: ['https://picsum.photos/300/200?food=2'],
        likes: 256,
        comments: 48,
        shares: 22,
        postTime: '昨天',
        isLiked: false
      },
      {
        id: 1733500000003,
        author: '素食主义者',
        avatar: 'https://picsum.photos/64/64?user=4',
        content: '超好吃的素食家常菜，无肉也超香！#素食 #家常菜',
        images: ['https://picsum.photos/300/200?food=3'],
        likes: 89,
        comments: 21,
        shares: 9,
        postTime: '3天前',
        isLiked: false
      }
    ];

    // 保存帖子到本地存储
    function savePostsToLocalStorage() {
      localStorage.setItem('communityPosts', JSON.stringify(communityPosts));
    }

    // ========== 删除帖子核心函数 ==========
    function deletePost(postId) {
      // 确认删除
      if (!confirm('确定要删除这篇帖子吗？删除后无法恢复！')) {
        return;
      }

      // 过滤掉要删除的帖子
      communityPosts = communityPosts.filter(post => post.id !== postId);
      // 保存到本地存储
      savePostsToLocalStorage();
      // 重新渲染帖子列表
      renderCommunityPosts();

      alert('帖子删除成功！');
    }

    // ========== 基础交互 ==========
    // 移动端菜单
    document.getElementById('menuBtn').addEventListener('click', function () {
      const mobileMenu = document.getElementById('mobileMenu');
      mobileMenu.classList.toggle('hidden');
    });

    // ========== 帖子渲染核心函数 ==========
    function renderCommunityPosts(filterTag = '全部') {
      const postsContainer = document.getElementById('communityPosts');

      // 筛选帖子
      let filteredPosts = communityPosts;
      if (filterTag !== '全部') {
        filteredPosts = communityPosts.filter(post => post.content.includes(filterTag));
      }

      // 空状态处理
      if (filteredPosts.length === 0) {
        postsContainer.innerHTML = `
          <div class="bg-white rounded-xl shadow-lg p-10 text-center">
            <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center text-gray-400 mx-auto mb-4">
              <i class="fa fa-newspaper-o text-3xl"></i>
            </div>
            <h4 class="text-xl font-medium text-dark mb-2">暂无相关帖子</h4>
            <p class="text-gray-500 mb-6">快来发布第一条帖子吧！</p>
            <button id="emptyPublishBtn" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90 transition">
              <i class="fa fa-pencil mr-2"></i> 发布帖子
            </button>
          </div>
        `;
        // 空状态发布按钮绑定
        document.getElementById('emptyPublishBtn').addEventListener('click', () => {
          document.getElementById('publishModal').classList.remove('hidden');
        });
        return;
      }

      // 渲染帖子列表（新增删除按钮，仅自己发布的帖子显示）
      postsContainer.innerHTML = filteredPosts.map(post => `
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 post-card relative">
          <!-- 仅自己发布的帖子显示删除按钮 -->
          ${post.author === '我' ? `
            <button class="delete-post-btn absolute top-4 right-4 w-8 h-8 bg-red-50 rounded-full flex items-center justify-center text-red-500 hover:bg-red-100 transition" data-post-id="${post.id}">
              <i class="fa fa-trash"></i>
            </button>
          ` : ''}

          <!-- 作者信息 -->
          <div class="flex items-center mb-4">
            <img src="${post.avatar}" alt="${post.author}" class="w-10 h-10 rounded-full mr-3">
            <div>
              <h4 class="font-medium text-dark">${post.author}</h4>
              <p class="text-xs text-gray-500">${post.postTime}</p>
            </div>
          </div>

          <!-- 帖子内容 -->
          <div class="mb-4">
            <p class="text-gray-800">${post.content}</p>
          </div>

          <!-- 帖子图片 -->
          ${post.images.length > 0 ? `
            <div class="grid grid-cols-${Math.min(post.images.length, 3)} gap-2 mb-4">
              ${post.images.map(img => `
                <img src="${img}" alt="帖子图片" class="rounded-lg w-full h-40 object-cover">
              `).join('')}
            </div>
          ` : ''}

          <!-- 互动按钮 -->
          <div class="flex items-center justify-between pt-4 border-t border-gray-100">
            <button class="like-btn flex items-center text-gray-500 hover:text-red-500 transition" data-post-id="${post.id}">
              <i class="fa fa-heart ${post.isLiked ? 'text-red-500' : ''} mr-2"></i>
              <span>${post.likes}</span>
            </button>
            <button class="comment-btn flex items-center text-gray-500 hover:text-primary transition">
              <i class="fa fa-comment mr-2"></i>
              <span>${post.comments}</span>
            </button>
            <button class="share-btn flex items-center text-gray-500 hover:text-secondary transition">
              <i class="fa fa-share mr-2"></i>
              <span>${post.shares}</span>
            </button>
          </div>
        </div>
      `).join('');

      // 绑定点赞事件
      document.querySelectorAll('.like-btn').forEach(btn => {
        btn.addEventListener('click', function () {
          const postId = Number(this.dataset.postId);
          const post = communityPosts.find(p => p.id === postId);
          if (post) {
            if (post.isLiked) {
              post.likes--;
              post.isLiked = false;
              this.querySelector('i').classList.remove('text-red-500');
            } else {
              post.likes++;
              post.isLiked = true;
              this.querySelector('i').classList.add('text-red-500');
            }
            savePostsToLocalStorage();
            this.querySelector('span').textContent = post.likes;
          }
        });
      });

      // 绑定删除帖子事件
      document.querySelectorAll('.delete-post-btn').forEach(btn => {
        btn.addEventListener('click', function () {
          const postId = Number(this.dataset.postId);
          deletePost(postId);
        });
      });

      // 绑定评论/分享事件（示例）
      document.querySelectorAll('.comment-btn').forEach(btn => {
        btn.addEventListener('click', () => alert('评论功能可在此扩展'));
      });
      document.querySelectorAll('.share-btn').forEach(btn => {
        btn.addEventListener('click', () => alert('分享功能可在此扩展'));
      });
    }

    // ========== 发布帖子模态框 ==========
    // 打开模态框
    document.getElementById('publishBtn').addEventListener('click', function () {
      document.getElementById('publishModal').classList.remove('hidden');
    });

    // 关闭模态框
    document.getElementById('closePublishModal').addEventListener('click', function () {
      document.getElementById('publishModal').classList.add('hidden');
    });
    document.getElementById('cancelPublish').addEventListener('click', function () {
      document.getElementById('publishModal').classList.add('hidden');
    });
    // 点击外部关闭
    document.getElementById('publishModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('publishModal')) {
        document.getElementById('publishModal').classList.add('hidden');
      }
    });

    // ========== 图片上传预览 ==========
    const postImages = document.getElementById('postImages');
    const imagePreview = document.getElementById('imagePreview');
    let selectedImages = [];

    postImages.addEventListener('change', function (e) {
      if (selectedImages.length + e.target.files.length > 9) {
        alert('最多只能上传9张图片');
        return;
      }

      Array.from(e.target.files).forEach(file => {
        if (!file.type.startsWith('image/')) {
          alert('请选择图片文件');
          return;
        }

        const reader = new FileReader();
        reader.onload = function (event) {
          const imgId = `img-${Date.now()}`;
          selectedImages.push({
            id: imgId,
            url: event.target.result,
            file: file
          });

          const previewItem = document.createElement('div');
          previewItem.className = 'preview-item';
          previewItem.dataset.id = imgId;
          previewItem.innerHTML = `
            <img src="${event.target.result}" alt="预览图" class="w-16 h-16 rounded-lg">
            <div class="remove-img" data-id="${imgId}">
              <i class="fa fa-times"></i>
            </div>
          `;
          imagePreview.appendChild(previewItem);

          // 删除图片
          previewItem.querySelector('.remove-img').addEventListener('click', function () {
            const id = this.dataset.id;
            selectedImages = selectedImages.filter(img => img.id !== id);
            previewItem.remove();
          });
        };
        reader.readAsDataURL(file);
      });
      postImages.value = ''; // 清空以允许重复选择
    });

    // ========== 发布帖子提交 ==========
    document.getElementById('publishPostForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const content = document.getElementById('postContent').value.trim();

      if (!content) {
        alert('请输入帖子内容');
        return;
      }

      // 新建帖子
      const newPost = {
        id: Date.now(),
        author: '我',
        avatar: 'https://picsum.photos/64/64?user=1',
        content: content,
        images: selectedImages.map(img => img.url),
        likes: 0,
        comments: 0,
        shares: 0,
        postTime: '刚刚',
        isLiked: false
      };

      // 添加并保存
      communityPosts.unshift(newPost);
      savePostsToLocalStorage();
      renderCommunityPosts();

      // 重置表单
      document.getElementById('postContent').value = '';
      imagePreview.innerHTML = '';
      selectedImages = [];
      document.getElementById('publishModal').classList.add('hidden');

      alert('帖子发布成功！');
    });

    // ========== 标签筛选 ==========
    document.querySelectorAll('.community-tag').forEach(tag => {
      tag.addEventListener('click', function () {
        // 重置标签样式
        document.querySelectorAll('.community-tag').forEach(t => {
          t.classList.remove('active', 'bg-primary', 'text-white');
          t.classList.add('bg-gray-100', 'text-dark');
        });
        // 激活当前标签
        this.classList.add('active', 'bg-primary', 'text-white');
        this.classList.remove('bg-gray-100', 'text-dark');
        // 渲染筛选结果
        renderCommunityPosts(this.textContent.trim());
      });
    });

    // ========== 加载更多 ==========
    document.getElementById('loadMorePosts').addEventListener('click', function () {
      this.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i> 加载中...';
      this.disabled = true;

      setTimeout(() => {
        // 模拟加载更多帖子
        const morePosts = [
          {
            id: Date.now() - 1000,
            author: '美食爱好者',
            avatar: 'https://picsum.photos/64/64?user=5',
            content: '低卡家常菜，好吃不胖！#家常菜 #低卡',
            images: ['https://picsum.photos/300/200?food=4'],
            likes: 78,
            comments: 19,
            shares: 8,
            postTime: '4天前',
            isLiked: false
          }
        ];
        communityPosts = [...communityPosts, ...morePosts];
        savePostsToLocalStorage();
        renderCommunityPosts();

        this.innerHTML = '加载更多 <i class="fa fa-refresh ml-2"></i>';
        this.disabled = false;
        alert('已加载更多帖子！');
      }, 1500);
    });

    // ========== 页面初始化 ==========
    window.addEventListener('load', function () {
      renderCommunityPosts();
    });
  </script>
</body>

</html>